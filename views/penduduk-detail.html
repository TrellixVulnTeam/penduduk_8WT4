{% extends 'base.html' %}
{% block title %}
     User
{% endblock %}

{% block inlinecss %}
<style>
    .page-profile-v1-avatar {
        max-width: 160px;
        border: 4px solid #fff;
    }
</style>
{% endblock %}
<!-- Content -->
{% block content %}
<div class="row m-t-1">
    <div class="col-md-4 col-lg-3">
        <div class="text-xs-center">
            <img src="/demo/avatars/account.png" alt="" class="page-profile-v1-avatar border-round" id="profilePicture">
        </div>
        <div class="m-y-3 text-xs-center">
            <a href="#" class="btn btn-success">
                <i class="fa fa-check"></i>&nbsp;&nbsp;Ketua RT</a>&nbsp;&nbsp;
            <a href="#" class="btn">
                <i class="fa fa-envelope"></i>
            </a>
        </div>
        <div class="panel panel-transparent">
            <div class="panel-heading p-x-1">
                <span class="panel-title">About me</span>
            </div>
            <div class="panel-body p-a-1">
                Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
                <a href="#">dolore magna</a> aliqua.
            </div>
        </div>
        <div class="panel panel-transparent">
            <div class="panel-heading p-x-1">
                <span class="panel-title">Statistics</span>
            </div>
            <div class="list-group m-y-1">
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <strong>126</strong> Likes</a>
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <strong>579</strong> Followers</a>
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <strong>100</strong> Following</a>
            </div>
        </div>
        <div class="panel panel-transparent">
            <div class="panel-heading p-x-1">
                <span class="panel-title">Skills</span>
            </div>
            <div class="panel-body p-a-1">
                <span class="label label-primary">UI/UX</span>
                <span class="label label-primary">Web design</span>
                <span class="label label-primary">Photoshop</span>
                <span class="label label-primary">HTML</span>
                <span class="label label-primary">CSS</span>
            </div>
        </div>
        <div class="panel panel-transparent">
            <div class="panel-heading p-x-1">
                <span class="panel-title">Social</span>
            </div>
            <div class="list-group m-t-1">
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <i class="fa fa-twitter" style="color: #4ab6d5"></i>&nbsp;&nbsp;&nbsp;@dsteiner</a>
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <i class="fa fa-facebook-square" style="color: #1a7ab9"></i>&nbsp;&nbsp;&nbsp;Denise Steiner</a>
                <a href="#" class="list-group-item p-x-1 b-a-0">
                    <i class="fa fa-envelope" style="color: #888"></i>&nbsp;&nbsp;&nbsp;dsteiner@example.com</a>
            </div>
        </div>
    </div>

    <hr class="page-wide-block visible-xs visible-sm">

    <div class="col-md-8 col-lg-9">
        <h1 class="font-size-20 m-y-4">
            <span id="profileName"><span style="background: #eeeeee;color:transparent;border-radius: 3px">Nama Penduduk Profil</span></span>
            
        </h1>

        <ul class="nav nav-tabs" id="profile-tabs">
            <li class="active">
                <a href="#profileInfo" data-toggle="tab" id="profileInfoBtn">
                    Data Pribadi
                </a>
            </li>
            <li>
                <a href="#familyInfo" data-toggle="tab" id="familyInfoBtn">
                    Data Keluarga
                </a>
            </li>
            <li>
                <a href="#assetInfo" data-toggle="tab" id="assetInfoBtn">
                    Data Aset
                </a>
            </li>
        </ul>

        <div class="tab-content tab-content-bordered p-a-0 bg-white">
            <div class="tab-pane fade in active" id="profileInfo">
                <h4 class="text-center" style="padding: 30px;">Loading Data..</h4>
            </div>
            <div class="tab-pane fade" id="familyInfo">
                <h4 class="text-center" style="padding: 30px;">Loading Data..</h4>   
            </div>
            <div class="tab-pane fade" id="assetInfo">
                <div class="widget-followers-item">
                    <img src="/demo/avatars/account.png" alt="" class="widget-followers-avatar">
                    <div class="widget-followers-controls">
                        <a href="#" class="btn btn-sm btn-success">
                            <i class="fa fa-check"></i>&nbsp;&nbsp;Following</a>
                    </div>
                    <a href="#" class="widget-followers-name">Robert Jang</a>
                    <a href="#" class="widget-followers-username">@rjang</a>
                </div>

                <div class="widget-followers-item">
                    <img src="/demo/avatars/account.png" alt="" class="widget-followers-avatar">
                    <div class="widget-followers-controls">
                        <a href="#" class="btn btn-sm btn-outline">Follow</a>
                    </div>
                    <a href="#" class="widget-followers-name">Michelle Bortz</a>
                    <a href="#" class="widget-followers-username">@mbortz</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block inlinejs  %}
    <script type="text/javascript">
        var profileInfo = $('#profileInfo');
        var familyInfo = $('#familyInfo');
        var assetInfo = $('#assetInfo');
        var id = '{{id}}';

        var penduduk = db.collection('penduduk');
        var person = penduduk.doc(id);
        var storageRef = storage.ref();

        var dataContainer = $('#dataContainer');
        var counter = 1;
        var dataArray = [];
        var selectArray = [];
        var result = null;

        console.log(dataArray);

        $(function(){
            $('#profileInfoBtn').click();
        });

        function addData(id,name,count){
            dataContainer.append(
            '<tr>'+
                '<th  scope="row">'+counter+'</th>'+
                '<td><a href="/penduduk-detail/'+id+'">'+name+'</a></td>'+
                '<td>'+count+'</td>'+
            '</tr>'
            );
            counter++;
        }
        
        $('#profileInfoBtn').on('click',function(){
                person.get().then((doc)=>{
                if(doc && doc.exists){
                    var data = doc.data();
                    var name = data.nama_lengkap;
                    $('#profileName').html(name+'<span class="font-weight-normal">\'s profile</span>');
                    var gender = data.jenis_kelamin;
                    var income = data.kirasan_penghasilan;
                    var job = data.pekerjaan;
                    var education = data.pendidikan;
                    var nationality = data.kewarganegaraan;
                    var marriage = data.status_perkawinan;
                    var birthPlace = data.tempat_lahir;
                    var birthDate = data.tanggal_lahir;
                    var idPicture = data.foto_ktp;
                    var profilePicture = data.foto_orang;
                    var province = data.provinsi;
                    var city = data.kota;
                    var district = data.kecamatan;
                    var subdistrict = data.kelurahan;
                    var rw = data.rw;
                    var rt = data.rt;

                    storageRef.child(profilePicture).getDownloadURL().then((url)=>{
                        var image = $('#profilePicture');
                        image.attr('src',url);
                    }).catch(function(error){

                    });

                    var arrayData = [
                        {title:'Nama Lengkap', content:name},
                        {title:'Jenis Kelamin', content:gender},
                        {title:'Kisaran Penghasilan', content:income},
                        {title:'Pekerjaan', content:job},
                        {title:'Pendidikan', content:education},
                        {title:'Kewarganegaraan', content:nationality},
                        {title:'Status Perkawinan', content:marriage},
                        {title:'Tempat dan Tanggal Lahir', content:birthPlace+', '+birthDate},
                        {title:'Provinsi', content:province},
                        {title:'Kota/Kabupaten', content:city},
                        {title:'Kecamatan', content:district},
                        {title:'Kelurahan', content:subdistrict},
                        {title:'RT/RW', content:rt+'/'+rw},
                    ];

                    console.log(arrayData);

                    var toAppend = '';
                    arrayData.forEach((data)=>{
                        toAppend+='<tr>'+
                                    '<td style="padding:20px">'+
                                      '<div class="box m-a-0 bg-transparent">'+
                                        '<span class="page-messages-item-from box-cell text-default">'+
                                            data.title+
                                        '</span>'+
                                        '<div class="page-messages-item-subject box-cell">'+
                                            '<span class="text-default font-weight-bold">'+
                                                data.content+
                                            '</span>'+
                                        '</div>'+
                                      '</div>'+
                                    '</td>'+
                                  '</tr>';
                    });

                    profileInfo.html('');
                    profileInfo.append(
                        '<table class="page-messages-items table m-a-0">'+
                                '<tbody>'+
                                    toAppend+
                                '</tbody>'+
                        '</table>'
                    );
                }
            });
        });

        var src = '';


        $('#familyInfoBtn').on('click',function(){
            var members = person.collection('anggota');
            // if(members && members.exists){
                members.get().then((query)=>{
                    familyInfo.html(''); 
                    query.forEach((doc)=>{
                        data=doc.data();
                        var type = data.jenis;
                        var name = data.nama_lengkap;
                        var gender = data.jenis_kelamin;
                        var profilePicture = data.foto_orang;

                        if(profilePicture){
                            storageRef.child(profilePicture).getDownloadURL().then((url)=>{
                                familyInfo.append(
                                    '<div class="widget-followers-item">'+
                                        '<img src="'+url+'" alt="" class="widget-followers-avatar">'+
                                        '<div class="widget-followers-controls">'+
                                            '<a href="#" class="btn btn-sm btn-outline">'+type+'</a>'+
                                        '</div>'+
                                        '<a href="#" class="widget-followers-name">'+name+'</a>'+
                                        '<a href="#" class="widget-followers-username">'+gender+'</a>'+
                                    '</div>'
                                );
                            }).catch((error)=>{
                                familyInfo.append(
                                    '<div class="widget-followers-item">'+
                                        '<img src="/demo/avatars/account.png" alt="" class="widget-followers-avatar">'+
                                        '<div class="widget-followers-controls">'+
                                            '<a href="#" class="btn btn-sm btn-outline">'+type+'</a>'+
                                        '</div>'+
                                        '<a href="#" class="widget-followers-name">'+name+'</a>'+
                                        '<a href="#" class="widget-followers-username">'+gender+'</a>'+
                                    '</div>'
                                );
                            });
                        }
                        else{
                            familyInfo.append(
                                    '<div class="widget-followers-item">'+
                                        '<img src="/demo/avatars/account.png" alt="" class="widget-followers-avatar">'+
                                        '<div class="widget-followers-controls">'+
                                            '<a href="#" class="btn btn-sm btn-outline">'+type+'</a>'+
                                        '</div>'+
                                        '<a href="#" class="widget-followers-name">'+name+'</a>'+
                                        '<a href="#" class="widget-followers-username">'+gender+'</a>'+
                                    '</div>'
                                );
                        }

                        
                    });
                });
            // }
            
            
        });

        $('#assetInfoBtn').on('click',function(){

        });

        
    </script>
{% endblock %}
