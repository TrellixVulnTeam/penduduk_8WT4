{% extends 'base.html' %}
{% block title %}
     RT
{% endblock %}
  <!-- Content -->
{% block content %}
    <div class="page-header">
        <p>
            <span class="text-muted font-weight-light">Penduduk / </span>
            Provinsi :
            <select>
                <option>Aceh</option>
                <option selected>Jakarta</option>
            </select> / Kota :
            <select>
                <option>Jakarta Utara</option>
                <option>Jakarta Selatan</option>
            </select> / Kecamatan :
            <select>
                <option>Kecamatan 1</option>
                <option>Kecamata 2</option>
            </select> / Kelurahan :
            <select>
                <option>Kelurahan 1</option>
                <option>Kelurahan 2</option>
            </select> / RW :
            <select>
                <option>RTW 1</option>
                <option selected>RW 2</option>
                <option>RW 3</option>
            </select> / RT :
            <select>
                <option>RT 001</option>
                <option>RT 002</option>
            </select>
        </p>
    </div>

    <div class="panel">
        <div class="panel-heading">
            <div class="panel-title">Basic</div>
        </div>
        <div class="panel-body">
            <table class="table table-striped">
                <caption>Optional table caption.</caption>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nama</th>
                        <th>Anggota</th>
                    </tr>
                </thead>
                <tbody id="dataContainer">
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
{% block inlinejs  %}
    <script type="text/javascript">
        var penduduk = db.collection('penduduk');
        var province = '{{provinsi}}';
        var city ='{{kota}}';
        var district ='{{kecamatan}}';
        var subdistrict ='{{kelurahan}}';
        var rw ='{{rw}}';
        var rt ='{{rt}}';

        var dataContainer = $('#dataContainer');
        var counter = 1;
        var dataArray = [];
        var selectArray = [];
        penduduk.where('provinsi','==',province).where('kota','==',city).where('kecamatan','==',district).where('kelurahan','==',subdistrict).where('rw','==',rw).where('rt','==',rt).get().then((querySnapshot)=>{
             querySnapshot.forEach((doc)=>{
                 if(doc && doc.exists){
                    data = doc.data();
                    // var exist = exists(data.rt,dataArray);
                    // console.log(exist);
                    // if(!exist){
                    //     addData(data.rt, dataArray);
                    // }   
                    var exist = exists(doc.id,dataArray);  
                    if(exist){
                        addData(doc.id,data.nama_lengkap,dataArray);
                    }    
                 }
             });

             dataArray.forEach((data)=>{
                console.log(data.name);
                dataContainer.append(
                    '<tr>'+
                        '<th  scope="row">'+counter+'</th>'+
                        '<td><a href="/penduduk-detail/'+data.id+'">'+data.name+'</a></td>'+
                        '<td>'+data.name+'</td>'+
                    '</tr>'
                );
                counter++;
            });
        });


        function exists(str, dataArray){
            var exist = false;
            dataArray.forEach((data)=>{
                if(str==data.id){
                    exist = true;
                    return exist;
                }
            });
            return exist;
        }

        function addData( id, str, dataArray){
            dataArray.push({id:id,name:str});
        }

        console.log('hahaha');
        console.log(dataArray);
    </script>
{% endblock %}