{% extends 'base.html' %}
{% block title %}
     RW {{rw}}
{% endblock %}
  <!-- Content -->
{% block content %}
    <div class="page-header">
        <p>
            <span class="text-muted font-weight-light">Indonesia / </span>
            Provinsi :
            <select>
                <option selected>Provinsi 1</option>
                <option>Provinsi 2</option>
                <option>Provinsi 3</option>
            </select> / Kota :
            <select>
                <option>Kota 1</option>
                <option selected>Kota 2</option>
                <option>Kota 3</option>
            </select> / Kecamatan :
            <select>
                <option>Kecamatan 1</option>
                <option selected>Kecamatan 2</option>
                <option>Kecamatan 3</option>
            </select> / Kelurahan :
            <select>
                <option>Kelurahan 1</option>
                <option selected>Kelurahan 2</option>
                <option>Kelurahan 3</option>
            </select> / RW :
            <select>
                <option>RW 1</option>
                <option>RW 2</option>
                <option selected>RW 3</option>
            </select>
        </p>
    </div>

    <div class="panel">
        <div class="panel-heading">
            <div class="panel-title">Basic</div>
        </div>
        <div class="panel-body">
            <table class="table table-striped">
                <caption>Optional table caption.</caption>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nama</th>
                        <th>Total       </th>
                    </tr>
                </thead>
                <tbody id="dataContainer">
      <tr><td></td><td>Loading Data..</td><td></td></tr>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
{% block inlinejs  %}
    <script type="text/javascript">
        var penduduk = db.collection('penduduk');
        var province = '{{provinsi}}';
        var city ='{{kota}}';
        var district ='{{kecamatan}}';
        var subdistrict ='{{kelurahan}}';
        var rw ='{{rw}}';

        var dataContainer = $('#dataContainer');
        var counter = 1;
        var dataArray = [];
        var selectArray = [];
        penduduk.where('provinsi','==',province).where('kota','==',city).where('kecamatan','==',district).where('kelurahan','==',subdistrict).where('rw','==',rw).get().then((querySnapshot)=>{
             querySnapshot.forEach((doc)=>{
                 if(doc && doc.exists){
                    var data = doc.data();
                    var exist = exists(data.rt,dataArray);
                    console.log(exist);
                    if(!exist){
                        addData(data.rt, dataArray);
                    }         
                 }
             });

            dataContainer.html('');
            dataArray.forEach((data)=>{
                console.log(data.name);

                dataContainer.append(
                    '<tr>'+
                        '<th  scope="row">'+counter+'</th>'+
                        '<td><a href="/rt/'+province+'/'+city+'/'+district+'/'+subdistrict+'/'+rw+'/'+data.name+'">'+data.name+'</a></td>'+
                        '<td>'+data.count+'</td>'+
                    '</tr>'
                );
                counter++;
            });
        });


        function exists(str, dataArray){
            var exist = false;
            dataArray.forEach((data)=>{
                if(str==data.name){
                    data.count=data.count+1;
                    exist = true;
                    return exist;
                }
            });
            return exist;
        }

        function addData( str, dataArray){
            dataArray.push({name:str,count:1});
        }

        console.log('hahaha');
        console.log(dataArray);
    </script>
{% endblock %}