{% extends 'base.html' %}
{% block title %}
     Detail Penduduk
{% endblock %}

{% block inlinecss %}
<style>
    .page-profile-v1-avatar {
        max-width: 160px;
        border: 4px solid #fff;
    }
</style>
{% endblock %}
<!-- Content -->
{% block content %}
<div class="row m-t-1">
    <div class="col-md-4 col-lg-3">
        <div class="text-xs-center">
            <img src="/demo/avatars/account.png" alt="" class="page-profile-v1-avatar border-round" id="profilePicture">
        </div>
        <div class="panel panel-transparent">
            <div class="panel-heading p-x-1">
                <p class="text-center" id="profileSummary">
                    <span style="background: #eeeeee;color:transparent;border-radius: 3px">Nama Penduduk Profilnya</span>
                </p>
            </div>
        </div>
        <div class="m-y-3 text-xs-center">
            <a href="#" class="btn btn-success" id="memberStatus">
                <span style="background: #eeeeee;color:transparent;border-radius: 3px">Nama Penduduk Profilnya</span>
            </a>
            <!-- <a href="#" class="btn">
                <i class="fa fa-envelope"></i>
            </a> -->
        </div>
        
    </div>

    <hr class="page-wide-block visible-xs visible-sm">

    <div class="col-md-8 col-lg-9">
        <h1 class="font-size-20 m-y-4">
            <span id="profileName">
                <a href="/penduduk-detail/{{kkId}}">Detail Penduduk</a> > Detail Anggota Keluarga
            </span>
            
        </h1>

        <ul class="nav nav-tabs" id="profile-tabs">
            <li class="active">
                <a href="#profileInfo" data-toggle="tab" id="profileInfoBtn">
                    Data Pribadi
                </a>
            </li>
        </ul>

        <div class="tab-content tab-content-bordered p-a-0 bg-white">
            <div class="tab-pane fade in active" id="profileInfo">
                <h4 class="text-center" style="padding: 30px;">Loading Data..</h4>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block inlinejs  %}
    <script type="text/javascript">
        var profileInfo = $('#profileInfo');
        var familyInfo = $('#familyInfo');
        var assetInfo = $('#assetInfo');
        var id = '{{id}}';
        var kkId = '{{kkId}}';

        var penduduk = db.collection('penduduk');
        var person = penduduk.doc(kkId).collection('anggota').doc(id);
        var storageRef = storage.ref();

        var dataContainer = $('#dataContainer');
        var counter = 1;
        var dataArray = [];
        var selectArray = [];
        var result = null;

        console.log(dataArray);

        $(function(){
            $('#profileInfoBtn').click();
        });

        function addData(id,name,count){
            dataContainer.append(
            '<tr>'+
                '<th  scope="row">'+counter+'</th>'+
                '<td><a href="/penduduk-detail/'+id+'">'+name+'</a></td>'+
                '<td>'+count+'</td>'+
            '</tr>'
            );
            counter++;
        }
        
        $('#profileInfoBtn').on('click',function(){
                person.get().then((doc)=>{
                if(doc && doc.exists){
                    var data = doc.data();
                    var name = data.nama_lengkap;
                    // $('#profileName').html(name+'<span class="font-weight-normal">\'s profile</span>');
                    var gender = data.jenis_kelamin;
                    var income = data.kirasan_penghasilan;
                    var job = data.pekerjaan;
                    var status = data.jenis;
                    $('#memberStatus').html('<i class="fa fa-check"></i>&nbsp;&nbsp;'+status);

                    var jobField = data.bidang_pekerjaan;
                    var bloodType = data.golongan_darah;
                    
                    var education = data.pendidikan;
                    $('#profileSummary').html('<strong><h4 style="margin-top:0;border-top:1px solid #eee;padding-top:20px">'+name+'</h4></strong>'+job+' | '+education)
                    var nationality = data.kewarganegaraan;
                    var marriage = data.status_perkawinan;
                    var birthPlace = data.tempat_lahir;
                    var birthDate = data.tanggal_lahir;
                    var idPicture = data.foto_ktp;
                    var profilePicture = data.foto_orang;

                    var religion = data.agama;
                    // var province = data.provinsi;
                    // var city = data.kota;
                    // var district = data.kecamatan;
                    // var subdistrict = data.kelurahan;
                    // var rw = data.rw;
                    // var rt = data.rt;

                    storageRef.child(profilePicture).getDownloadURL().then((url)=>{
                        var image = $('#profilePicture');
                        image.attr('src',url);
                    }).catch(function(error){

                    });

                    var arrayData = [
                        {title:'Nama Lengkap', content:name},
                        {title:'Jenis Kelamin', content:gender},
                        {title:'Kisaran Penghasilan', content:income},
                        
                        {title:'Bidang Pekerjaan', content:jobField},
                        {title:'Pekerjaan', content:job},

                        {title:'Pendidikan', content:education},
                        {title:'Kewarganegaraan', content:nationality},

                        {title:'Agama', content:religion},
                        {title:'Golongan Darah', content:bloodType},


                        {title:'Status Perkawinan', content:marriage},
                        {title:'Tempat dan Tanggal Lahir', content:birthPlace+', '+birthDate},
                        // {title:'Provinsi', content:province},
                        // {title:'Kota/Kabupaten', content:city},
                        // {title:'Kecamatan', content:district},
                        // {title:'Kelurahan', content:subdistrict},
                        // {title:'RT/RW', content:rt+'/'+rw},
                    ];

                    console.log(arrayData);

                    var toAppend = '';
                    arrayData.forEach((data)=>{
                        toAppend+='<tr>'+
                                    '<td style="padding:20px">'+
                                      '<div class="box m-a-0 bg-transparent">'+
                                        '<span class="page-messages-item-from box-cell text-default">'+
                                            data.title+
                                        '</span>'+
                                        '<div class="page-messages-item-subject box-cell">'+
                                            '<span class="text-default font-weight-bold">'+
                                                data.content+
                                            '</span>'+
                                        '</div>'+
                                      '</div>'+
                                    '</td>'+
                                  '</tr>';
                    });

                    profileInfo.html('');
                    profileInfo.append(
                        '<table class="page-messages-items table m-a-0">'+
                                '<tbody>'+
                                    toAppend+
                                '</tbody>'+
                        '</table>'
                    );
                }
            });
        });

        
    </script>
{% endblock %}
